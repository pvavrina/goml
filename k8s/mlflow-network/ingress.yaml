# Ingress manifest for MLflow tracking server
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: mlflow-ingress
  namespace: go-mlops
  annotations:
    # ArgoCD tracking ID
    argocd.argoproj.io/tracking-id: go-ml-service:networking.k8s.io/Ingress:go-mlops/mlflow-ingress
    # Traefik load-balancing algorithm (Weighted Round Robin)
    traefik.ingress.kubernetes.io/service-lb-algorithm: wrr
    # Ensure Traefik connects to the backend service (MLflow) using HTTP
    traefik.ingress.kubernetes.io/service.serversscheme: http
    # ðŸ’¡ ADDED: Traefik annotation to enable TLS and route traffic through websecure entrypoint
    traefik.ingress.kubernetes.io/router.entrypoints: websecure
spec:
  ingressClassName: traefik
  # ðŸ’¡ ADDED: TLS Configuration
  tls:
  - hosts:
    - mlflow.tuxjob.ch
    # Reference the Secret containing the TLS certificate (e.g., self-signed or Cert-manager generated)
    secretName: mlflow-tls-secret # Use your specific TLS secret name here
  rules:
  - host: mlflow.tuxjob.ch
    http:
      paths:
      - backend:
          service:
            name: mlflow-service
            port:
              number: 5000
        path: /
        pathType: Prefix
